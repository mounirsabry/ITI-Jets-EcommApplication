<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Profile | Book Alley</title>

    <script type="module">
        import LoadingOverlay from "./JavaScript/Common/LoadingOverlay.js";

        const loadingOverlay = new LoadingOverlay();
        loadingOverlay.createAndDisplay();

        window.addEventListener('load', () => {
            loadingOverlay.remove();
        });
    </script>

    <link rel="stylesheet" href="CSS/Common/reset.css"/>
    <link rel="stylesheet" href="CSS/Common/root.css"/>
    <link rel="stylesheet" href="CSS/Common/header.css"/>
    <link rel="stylesheet" href="CSS/Common/footer.css"/>
    <link rel="stylesheet" href="CSS/Common/main.css"/>
    <link rel="stylesheet" href="CSS/Common/MessagePopup.css"/>

    <link rel="stylesheet" href="CSS/profile.css"/>

    <script src="JavaScript/Common/context_path.js"></script>

    <script defer type="module" src="JavaScript/Common/header.js"></script>
    <script defer type="module" src="JavaScript/Common/footer.js"></script>

    <script defer type="module" src="JavaScript/profile.js"></script>
</head>
<body>
<header id="siteHeader">
    <!-- Header will be injected here by JS -->
</header>

<main>
    <div class="popup-overlay hidden">
        <!-- Will be controlled by JS -->
    </div>

    <div class="profile-actions">
        <button id="viewOrders">View Orders</button>
        <button id="viewPurchaseHistory">View Purchase History</button>
        <button id="viewWishList">View Wish List</button>
    </div>

    <h1 class="center-title">My Profile</h1>

    <!-- Change Password Section -->
    <section id="changePasswordSection">
        <button id="openChangePasswordPopupButton">Change Password</button>
    </section>

    <!-- Change Password Popup -->
    <div id="passwordPopup" class="popup hidden">
        <div class="popup-content">
            <h2>Change Password</h2>
            <p id="passwordChangeError" class="error"></p>
            <label for="currentPassword">Current Password:</label>
            <input type="password" id="currentPassword" required/>

            <label for="newPassword">New Password:</label>
            <input type="password" id="newPassword" required/>

            <label for="confirmPassword">Confirm New Password:</label>
            <input type="password" id="confirmPassword" required/>

            <div class="popup-buttons">
                <button id="confirmPasswordChangeButton">Change</button>
                <button id="cancelPasswordChangeButton">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Email Section -->
    <section id="emailSection">
        <p>
            <strong>Email:</strong>
            <span id="displayEmail"><!-- email will be written here by JavaScript --></span>
        </p>
        <button id="openChangeEmailPopupButton">Update Email</button>
    </section>

    <!-- Email Update Popup -->
    <div id="emailPopup" class="popup hidden">
        <div class="popup-content">
            <h2>Update Email</h2>
            <p id="emailChangeError" class="error">
                <!-- Error message will be injected here by JS when needed. -->
            </p>
            <label for="newEmail">New Email:</label>
            <input
                    type="email"
                    id="newEmail"
                    placeholder="Enter new email"
                    required
            />
            <div class="popup-buttons">
                <button id="confirmEmailUpdate">Confirm</button>
                <button id="cancelEmailUpdate">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Profile Information -->
    <section id="profileInfo" class="profile-section">
        <h2>Update Profile Info</h2>
        <form id="editProfileForm">
            <label for="editUserName">User Name:</label>
            <input type="text" id="editUserName" required/>

            <label for="editPhone">Phone:</label>
            <input type="tel" id="editPhone" required/>

            <label for="editAddress">Address:</label>
            <input type="text" id="editAddress" required/>

            <label for="editBirthDate">Birth Date:</label>
            <input type="date" id="editBirthDate" required/>

            <p id="profileChangesError" class="error">
                <!-- Error message will be injected here by JS when needed. -->
            </p>
            <button type="submit">Save Changes</button>
        </form>
    </section>

    <section class="profile-section">
        <label for="userBalance">User Balance:</label>
        <input type="text" id="userBalance" readonly/>

        <button type="button" id="rechargeBalanceButton">Recharge your account</button>
    </section>

    <!-- Recharge Balance Popup -->
    <div id="rechargePopup" class="popup hidden">
        <div class="popup-content">
            <h2>Recharge Your Balance</h2>
            <label for="rechargeAmount">Amount (EGP):</label>
            <input type="number" id="rechargeAmount" min="1" required>

            <h3>Credit Card Information</h3>
            <label for="rechargeNameOnCard">Name on Card:</label>
            <input type="text" id="rechargeNameOnCard" required>

            <label for="rechargeCardNumber">Card Number:</label>
            <input type="text" id="rechargeCardNumber" required>

            <div class="expiry-date-container">
                <div>
                    <label for="rechargeExpiryMonth">Expiry Month:</label>
                    <select id="rechargeExpiryMonth" required>
                        <option value="" disabled selected>MM</option>
                        <option value="01">01</option>
                        <option value="02">02</option>
                        <option value="03">03</option>
                        <option value="04">04</option>
                        <option value="05">05</option>
                        <option value="06">06</option>
                        <option value="07">07</option>
                        <option value="08">08</option>
                        <option value="09">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>
                </div>
                <div>
                    <label for="rechargeExpiryYear">Expiry Year:</label>
                    <select id="rechargeExpiryYear" required>
                        <option value="" disabled selected>YY</option>
                        <!-- Years will be populated by JavaScript -->
                    </select>
                </div>
            </div>

            <label for="rechargeCvc">CVC:</label>
            <input type="text" id="rechargeCvc" required>

            <div class="popup-buttons">
                <button id="confirmRecharge">Confirm Recharge</button>
                <button id="cancelRecharge">Cancel</button>
            </div>
        </div>
    </div>
</main>

<footer id="siteFooter">
    <!-- Footer will be injected here by JS -->
</footer>
</body>
</html>
