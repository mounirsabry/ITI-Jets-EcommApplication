<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Profile | Book Alley</title>

    <script type="module">
        import LoadingOverlay from "./JavaScript/Common/LoadingOverlay.js";

        const loadingOverlay = new LoadingOverlay();
        loadingOverlay.createAndDisplay();

        window.addEventListener('load', () => {
            loadingOverlay.remove();
        });
    </script>

    <link rel="stylesheet" href="CSS/Common/reset.css"/>
    <link rel="stylesheet" href="CSS/Common/root.css"/>
    <link rel="stylesheet" href="CSS/Common/header.css"/>
    <link rel="stylesheet" href="CSS/Common/footer.css"/>
    <link rel="stylesheet" href="CSS/Common/main.css"/>
    <link rel="stylesheet" href="CSS/Common/MessagePopup.css"/>
    <link rel="stylesheet" href="CSS/profile.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <script src="JavaScript/Common/context_path.js"></script>

    <script defer type="module" src="JavaScript/Common/header.js"></script>
    <script defer type="module" src="JavaScript/Common/footer.js"></script>

    <script defer type="module" src="JavaScript/profile.js"></script>
</head>
<body>
<header id="siteHeader">
    <!-- Header will be injected here by JS -->
</header>

<main>
    <section class="profile-actions">
        <button id="viewOrders"><i class="fas fa-box"></i> View Orders</button>
        <button id="viewPurchaseHistory"><i class="fas fa-history"></i> View Purchase History</button>
        <button id="viewWishList"><i class="fas fa-heart"></i> View Wish List</button>
    </section>

    <section id="emailSection" class="profile-section">
        <h2><i class="fas fa-envelope"></i> Email</h2>
        <p>
            Current Email: <span id="displayEmail"></span>
            <button id="openChangeEmailPopupButton">Change Email</button>
        </p>
    </section>

    <section id="changePasswordSection" class="profile-section">
        <h2><i class="fas fa-lock"></i> Password</h2>
        <button id="openChangePasswordPopupButton">Change Password</button>
    </section>

    <section class="profile-section">
        <h2><i class="fas fa-user"></i> Edit Profile</h2>
        <form id="editProfileForm">
            <div class="form-group">
                <label for="editUserName">Name</label>
                <input type="text" id="editUserName" required />
            </div>
            <div class="form-group">
                <label for="editPhone">Phone Number</label>
                <input type="text" id="editPhone" required />
            </div>
            <div class="form-group">
                <label for="editAddress">Address</label>
                <input type="text" id="editAddress" required />
            </div>
            <div class="form-group">
                <label for="editBirthDate">Birth Date</label>
                <input type="date" id="editBirthDate" required />
            </div>
            <div id="profileChangesError" class="error"></div>
            <button type="submit">Update Profile</button>
        </form>
    </section>

    <section class="profile-section">
        <h2><i class="fas fa-wallet"></i> Account Balance</h2>
        <div class="balance-container">
            <input id="userBalance" readonly />
            <button id="rechargeBalanceButton">Recharge Balance</button>
        </div>
    </section>

    <div class="popup-overlay hidden"></div>

    <div id="passwordPopup" class="popup hidden">
        <h2>Change Password</h2>
        <div class="form-group">
            <label for="currentPassword">Current Password</label>
            <input type="password" id="currentPassword" />
        </div>
        <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" />
        </div>
        <div class="form-group">
            <label for="confirmPassword">Confirm New Password</label>
            <input type="password" id="confirmPassword" />
        </div>
        <div id="passwordChangeError" class="error"></div>
        <div class="popup-buttons">
            <button id="confirmPasswordChangeButton">Confirm</button>
            <button id="cancelPasswordChangeButton">Cancel</button>
        </div>
    </div>

    <div id="emailPopup" class="popup hidden">
        <h2>Change Email</h2>
        <div class="form-group">
            <label for="newEmail">New Email</label>
            <input type="email" id="newEmail" />
        </div>
        <div id="emailChangeError" class="error"></div>
        <div class="popup-buttons">
            <button id="confirmEmailUpdate">Confirm</button>
            <button id="cancelEmailUpdate">Cancel</button>
        </div>
    </div>

    <div id="rechargePopup" class="popup hidden">
        <h2>Recharge Balance</h2>
        <div class="form-group">
            <label for="rechargeAmount">Amount (EGP)</label>
            <input type="number" id="rechargeAmount" min="0" step="0.01" />
        </div>
        <h3>Payment Details</h3>
        <div class="form-group">
            <label for="rechargeNameOnCard">Name on Card</label>
            <input type="text" id="rechargeNameOnCard" />
        </div>
        <div class="form-group">
            <label for="rechargeCardNumber">Card Number</label>
            <input type="text" id="rechargeCardNumber" />
        </div>
        <div class="expiry-date-container">
            <div>
                <label for="rechargeExpiryMonth">Expiry Month</label>
                <select id="rechargeExpiryMonth">
                    <option value="01">01</option>
                    <option value="02">02</option>
                    <option value="03">03</option>
                    <option value="04">04</option>
                    <option value="05">05</option>
                    <option value="06">06</option>
                    <option value="07">07</option>
                    <option value="08">08</option>
                    <option value="09">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select>
            </div>
            <div>
                <label for="rechargeExpiryYear">Expiry Year</label>
                <select id="rechargeExpiryYear"></select>
            </div>
        </div>
        <div class="form-group">
            <label for="rechargeCvc">CVC</label>
            <input type="text" id="rechargeCvc" />
        </div>
        <div class="popup-buttons">
            <button id="confirmRecharge">Confirm</button>
            <button id="cancelRecharge">Cancel</button>
        </div>
    </div>
</main>

<footer id="siteFooter">
    <!-- Footer will be injected here by JS -->
</footer>
</body>
</html>